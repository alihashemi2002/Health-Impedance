#ifndef _ADG731_3_H
#define	_ADG731_3_H

#include <xc.h>
#include <stdlib.h>
#include <stdint.h>
#include <stdlib.h>
#include <stdbool.h>
#include <stddef.h>
#include <string.h>
#include <limits.h>


/**********************************************************************************************************************************/
/*=== PIN ASSIGNMENTS ============================================================================================================*/
/**********************************************************************************************************************************/
#define sw3CsPin()                 (LATCbits.LATC2)                             // SW CS pin
#define sw3SpiOpenFrame()          (sw3CsPin() = 0)                             // SW SPI frame open
#define sw3SpiCloseFrame()         (sw3CsPin() = 1)                             // SW SPI frame close

/**********************************************************************************************************************************/
/*=== SYSTEM ASSIGNMENTS =========================================================================================================*/
/**********************************************************************************************************************************/
#define sw3SpiBuf()                SPI2BUF                                      // SPI hardware buffer in use
#define sw3SpiTxBufFull()          SPI2STATbits.SPITBF                          // SPI transmit buffer full flag
#define sw3SpiRxBufEmpty()         SPI2STATbits.SPIRBE                          // SPI receive buffer empty flag
#define sw3SpiBusy()               SPI2STATbits.SPIBUSY                         // SPI busy flag
#define sw3SpiCon()                (SPI2CON)                                    // SPIxCON associated with allocated SPI port
#define sw3SpiCon2()               (SPI2CON2)                                   // SPIxCON2 associated with allocated SPI port
#define sw3SpiBrg()                (SPI2BRG)                                    // SPIxBRG associated with allocated SPI port

/**********************************************************************************************************************************/
/*=== MACROS =====================================================================================================================*/
/**********************************************************************************************************************************/
#define sw3BufSize()              (UINT8_MAX+1)                                 // Soft buffer size
#define sw3CmdSize()              1                                             // command size
#define sw3Min()                  0                                             // Number of sw3itches
#define sw3Max()                  31                                            // Number of sw3itches
#define sw3Off()                  0                                             // Switch off identifier
#define sw3On()                   1                                             // Switch on idenfitifer

/*=== SWITCH STATE VALUES ========================================================================================================*/
#define sw3WriteState()           0x00                                          // State machine write state

/**********************************************************************************************************************************/
/*=== VARIABLES ==================================================================================================================*/
/**********************************************************************************************************************************/
typedef struct{
    uint8_t tx[sw3BufSize()];                                                    // TX soft buffer
    uint8_t txStart;                                                            // TX soft buffer start index
    uint8_t txEnd;                                                              // TX soft buffer end index    
    uint8_t state;                                                              // State machine state variable
    uint8_t actv;                                                               // Active sw3itch number
} sw3_obj;

/**********************************************************************************************************************************/
/*=== FUNCTION PROTOTYPES ========================================================================================================*/
/**********************************************************************************************************************************/

/*** sw3SpiInit *******************************************************************************************************************/
void sw3SpiInit(void);

/*** sw3SpiRxFifoClear ************************************************************************************************************/
void sw3SpiRxFifoClear(void);

/*** sw3Initialize ****************************************************************************************************************/
void sw3Initialize(void);

/*** sw3Sel ***********************************************************************************************************************/
bool sw3Sel(uint8_t sw3Num);

/*** sw3TxBytes *******************************************************************************************************************/
uint8_t sw3TxBytes(void);

/*** sw3Service *******************************************************************************************************************/
void sw3Service(void);

#endif                                                                          // End _ADG731_3_H