#ifndef _ADG731_4_H
#define	_ADG731_4_H

#include <xc.h>
#include <stdlib.h>
#include <stdint.h>
#include <stdlib.h>
#include <stdbool.h>
#include <stddef.h>
#include <string.h>
#include <limits.h>


/**********************************************************************************************************************************/
/*=== PIN ASSIGNMENTS ============================================================================================================*/
/**********************************************************************************************************************************/
#define sw4CsPin()                 (LATCbits.LATC3)                             // SW CS pin
#define sw4SpiOpenFrame()          (sw4CsPin() = 0)                             // SW SPI frame open
#define sw4SpiCloseFrame()         (sw4CsPin() = 1)                             // SW SPI frame close

/**********************************************************************************************************************************/
/*=== SYSTEM ASSIGNMENTS =========================================================================================================*/
/**********************************************************************************************************************************/
#define sw4SpiBuf()                SPI2BUF                                      // SPI hardware buffer in use
#define sw4SpiTxBufFull()          SPI2STATbits.SPITBF                          // SPI transmit buffer full flag
#define sw4SpiRxBufEmpty()         SPI2STATbits.SPIRBE                          // SPI receive buffer empty flag
#define sw4SpiBusy()               SPI2STATbits.SPIBUSY                         // SPI busy flag
#define sw4SpiCon()                (SPI2CON)                                    // SPIxCON associated with allocated SPI port
#define sw4SpiCon2()               (SPI2CON2)                                   // SPIxCON2 associated with allocated SPI port
#define sw4SpiBrg()                (SPI2BRG)                                    // SPIxBRG associated with allocated SPI port

/**********************************************************************************************************************************/
/*=== MACROS =====================================================================================================================*/
/**********************************************************************************************************************************/
#define sw4BufSize()              (UINT8_MAX+1)                                 // Soft buffer size
#define sw4CmdSize()              1                                             // command size
#define sw4Min()                  0                                             // Number of sw4itches
#define sw4Max()                  31                                            // Number of sw4itches
#define sw4Off()                  0                                             // Switch off identifier
#define sw4On()                   1                                             // Switch on idenfitifer

/*=== SWITCH STATE VALUES ========================================================================================================*/
#define sw4WriteState()           0x00                                          // State machine write state

/**********************************************************************************************************************************/
/*=== VARIABLES ==================================================================================================================*/
/**********************************************************************************************************************************/
typedef struct{
    uint8_t tx[sw4BufSize()];                                                    // TX soft buffer
    uint8_t txStart;                                                            // TX soft buffer start index
    uint8_t txEnd;                                                              // TX soft buffer end index    
    uint8_t state;                                                              // State machine state variable
    uint8_t actv;                                                               // Active sw4itch number
} sw4_obj;

/**********************************************************************************************************************************/
/*=== FUNCTION PROTOTYPES ========================================================================================================*/
/**********************************************************************************************************************************/

/*** sw4SpiInit *******************************************************************************************************************/
void sw4SpiInit(void);

/*** sw4SpiRxFifoClear ************************************************************************************************************/
void sw4SpiRxFifoClear(void);

/*** sw4Initialize ****************************************************************************************************************/
void sw4Initialize(void);

/*** sw4Sel ***********************************************************************************************************************/
bool sw4Sel(uint8_t sw4Num);

/*** sw4TxBytes *******************************************************************************************************************/
uint8_t sw4TxBytes(void);

/*** sw4Service *******************************************************************************************************************/
void sw4Service(void);

#endif                                                                          // End _ADG731_4_H